# ==============================================================================
# Mountain House Thermostat - Docker Compose Environment Variables
# ==============================================================================
# Copy this file to .env and customize for your deployment:
#   cp .env.compose.example .env
#
# IMPORTANT: Do NOT commit .env with real credentials to version control!
# ==============================================================================

# ------------------------------------------------------------------------------
# HVAC Connection (Backend - cz2)
# ------------------------------------------------------------------------------
# Connection string: "host:port" for TCP/IP serial bridge or "/dev/ttyUSB0"
# for direct serial (must mount device into container)
# Example TCP: "10.0.1.20:8899" (USR-W610 adapter)
# Example Serial: "/dev/ttyUSB0" (requires --device flag in docker run)
CZ_CONNECT=10.0.1.20:8899

# Number of zones in your HVAC system (1-8)
CZ_ZONES=4

# Comma-separated zone names (must match CZ_ZONES count)
CZ_ZONE_NAMES=Main Room,Upstairs,Downstairs,Office

# Device ID for pycz2 on RS-485 bus (1-255, must be unique)
CZ_ID=99

# ------------------------------------------------------------------------------
# Backend API Settings
# ------------------------------------------------------------------------------
# Internal API host (0.0.0.0 listens on all container interfaces)
API_HOST=0.0.0.0
API_PORT=8000

# Host port mapping for backend API (external:internal)
# Access backend at http://localhost:8000
CZ2_HOST_PORT=8000

# ------------------------------------------------------------------------------
# MQTT Broker Settings
# ------------------------------------------------------------------------------
# Enable MQTT publishing of HVAC status
MQTT_ENABLED=true

# MQTT broker hostname
# Production: host.docker.internal (reaches host's HA Mosquitto on localhost:1883)
# Docker internal: mosquitto (if running Mosquitto in compose - not recommended)
MQTT_HOST=host.docker.internal

# MQTT broker port (1883: unencrypted, 8883: TLS)
MQTT_PORT=1883

# MQTT authentication (update for production!)
# Leave empty if broker doesn't require auth
MQTT_USER=
MQTT_PASSWORD=

# MQTT topic prefix for status messages
MQTT_TOPIC_PREFIX=hvac/cz2

# Status publish interval (seconds, minimum: 5)
MQTT_PUBLISH_INTERVAL=60

# Host port mappings for MQTT broker
MQTT_HOST_PORT=1883
MQTT_WS_PORT=9001

# ------------------------------------------------------------------------------
# Frontend Settings
# ------------------------------------------------------------------------------
# Host port mapping for frontend (external:internal)
# Production: 4175 (avoids conflict with local dev on 4173)
FRONTEND_HOST_PORT=4175

# Frontend build-time env vars (overridden at runtime via RUNTIME_* envs)
# Production: Use Caddy reverse proxy URLs
# Local dev: Use localhost URLs in .env.development
VITE_API_BASE_URL=https://tstat.mtnhouse.casa/api
VITE_MQTT_WS_URL=wss://mqtt.mtnhouse.casa

# Frontend API timeout (milliseconds)
VITE_API_TIMEOUT_MS=15000

# ------------------------------------------------------------------------------
# Backend Cache Settings
# ------------------------------------------------------------------------------
# Enable in-memory cache for instant responses when HVAC offline
ENABLE_CACHE=true

# Mark cached data as stale after N seconds (minimum: 10)
CACHE_STALE_SECONDS=300

# Cache refresh interval (seconds, minimum: 30)
CACHE_REFRESH_INTERVAL=300

# SQLite cache database path (internal to container)
# Persisted via Docker volume: cz2-cache
CACHE_DB_PATH=/home/appuser/.cache/pycz2/cache.db

# ------------------------------------------------------------------------------
# Worker & SSE Settings
# ------------------------------------------------------------------------------
# Disable legacy worker (use CLI-style service)
WORKER_ENABLED=false

# Enable Server-Sent Events for real-time frontend updates
ENABLE_SSE=true

# SSE heartbeat interval (seconds, minimum: 10)
SSE_HEARTBEAT_INTERVAL=30

# Maximum SSE subscribers per IP (minimum: 1)
SSE_MAX_SUBSCRIBERS_PER_IP=5

# ------------------------------------------------------------------------------
# Command Queue Settings
# ------------------------------------------------------------------------------
# Maximum pending HVAC commands (minimum: 10)
COMMAND_QUEUE_MAX_SIZE=100

# Command execution timeout (seconds, minimum: 5)
COMMAND_TIMEOUT_SECONDS=30

# ------------------------------------------------------------------------------
# Healthcheck Integration (Optional)
# ------------------------------------------------------------------------------
# UUID from healthchecks.io for monitoring HVAC poll success
# Get your UUID from https://healthchecks.io after creating a check
# Leave empty to disable healthcheck pings
HEALTHCHECK_UUID=

# Base URL for healthcheck service (default works for healthchecks.tpeet.net)
# For self-hosted instances, update to your server URL
HEALTHCHECK_BASE_URL=https://healthchecks.tpeet.net/ping

# Timeout for healthcheck HTTP requests (seconds, minimum: 1)
HEALTHCHECK_TIMEOUT=5

# ==============================================================================
# Production Deployment Notes:
#
# 1. Update CZ_CONNECT to your HVAC serial bridge IP/port
# 2. Set strong MQTT_USER and MQTT_PASSWORD (if using auth)
# 3. Use external MQTT broker for production (disable internal mosquitto)
# 4. Configure host-level Caddy for TLS termination:
#    - Reverse proxy frontend:4173 -> https://yourdomain.com
#    - Reverse proxy cz2:8000 -> https://api.yourdomain.com
#    - WebSocket proxy mosquitto:9001 -> wss://mqtt.yourdomain.com
# 5. Update VITE_MQTT_WS_URL to wss://mqtt.yourdomain.com
# 6. Restrict host port exposure in production (use internal Docker network)
# ==============================================================================
